<script setup>
import { ref } from 'vue';
import { useRouter } from 'vue-router';
import { useAuthStore } from '../stores/auth';

const auth = useAuthStore();
const router = useRouter();
const userQuestion = ref('');

// State for the new sign-up flow
const showSignupForm = ref(false);
const acceptedTerms = ref(false);

// State for disclaimer
const isDisclaimerExpanded = ref(false);

const startChat = () => {
    if (!userQuestion.value.trim()) {
        router.push('/chat');
        return;
    }
    router.push({ path: '/chat', query: { q: userQuestion.value } });
};

const displaySignupForm = () => {
    showSignupForm.value = true;
};

const handleSignup = () => {
    if (!acceptedTerms.value) return;
    // In a real app, you'd save the form data here.
    auth.login();
    showSignupForm.value = false; // Reset view for next time
};

</script>

<template>
    <div class="landing-container">
        <!-- Temporary simulation controls -->
        <div class="simulation-controls">
            <p>Simulaci√≥n:</p>
            <button @click="auth.login">Login</button>
            <button @click="auth.logout">Logout</button>
        </div>

        <div class="main-content">
            <h1 class="title">üîÆ Or√°culo IA üîÆ</h1>
            
            <!-- LOGGED-OUT & SIGNUP FLOW -->
            <div v-if="!auth.isLoggedIn">
                <!-- Default Logged-out View -->
                <div v-if="!showSignupForm">
                    <p class="subtitle">Descubre lo que el destino tiene para ti. Recibe gu√≠a sobre tu pasado, presente y futuro a trav√©s de la sabidur√≠a del Tarot.</p>
                    <div class="social-login">
                        <p>Reg√≠strate o inicia sesi√≥n con:</p>
                        <div class="social-buttons">
                            <button @click="displaySignupForm" class="social-btn google">Google</button>
                            <button @click="displaySignupForm" class="social-btn facebook">Facebook</button>
                            <button @click="displaySignupForm" class="social-btn tiktok">TikTok</button>
                        </div>
                    </div>
                    <div class="offer-section">
                        <h2>Nuestra Oferta</h2>
                        <div class="offers">
                            <div class="offer-card">
                                <h3>Gratis</h3>
                                <p>1 pregunta a la semana, para siempre.</p>
                            </div>
                            <router-link to="/checkout" class="offer-card-link">
                                <div class="offer-card premium">
                                    <h3>Semana de Lanzamiento</h3>
                                    <p>Preguntas ilimitadas por solo <strong>$1</strong>.</p>
                                </div>
                            </router-link>
                            <router-link to="/checkout" class="offer-card-link">
                                <div class="offer-card">
                                    <h3>Ilimitado</h3>
                                    <p><strong>$5</strong> por semana de preguntas ilimitadas.</p>
                                </div>
                            </router-link>
                        </div>
                    </div>
                </div>

                <!-- Sign-up Form View -->
                <div v-else class="signup-form-container">
                    <h2 class="signup-title">Casi listo...</h2>
                    <p class="subtitle">Completa tu perfil para continuar.</p>
                    <form @submit.prevent="handleSignup" class="signup-form">
                        <div class="form-group">
                            <label for="name">Nombre</label>
                            <input type="text" id="name" placeholder="Tu nombre" required>
                        </div>
                        <div class="form-group">
                            <label for="gender">G√©nero</label>
                            <select id="gender" required>
                                <option value="" disabled selected>Selecciona una opci√≥n</option>
                                <option value="male">Masculino</option>
                                <option value="female">Femenino</option>
                                <option value="non-binary">No binario</option>
                                <option value="prefer-not-to-say">Prefiero no decir</option>
                                <option value="other">Otro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dob">Fecha de Nacimiento</label>
                            <input type="date" id="dob" required>
                        </div>
                        <div class="form-group terms">
                            <input type="checkbox" id="terms" v-model="acceptedTerms">
                            <label for="terms">Acepto los <router-link to="/terms" target="_blank">T√©rminos y Condiciones</router-link>.</label>
                        </div>
                        <button type="submit" class="main-cta-button" :disabled="!acceptedTerms">Finalizar Registro</button>
                    </form>
                </div>
            </div>

            <!-- LOGGED-IN VIEW -->
            <div v-else class="loggedin-view">
                <p class="subtitle">Bienvenido de nuevo. El or√°culo espera tu consulta.</p>
                <div class="initial-chat-box">
                    <textarea v-model="userQuestion" class="question-input" placeholder="Escribe tu pregunta aqu√≠ para comenzar una nueva lectura..."></textarea>
                    <button @click="startChat" class="main-cta-button">Iniciar Lectura</button>
                </div>
            </div>

            <div class="disclaimer">
                <p>Recuerda que el tarot es una herramienta de gu√≠a y autoconocimiento. Las lecturas ofrecen perspectivas y no deben ser tomadas como predicciones absolutas del futuro. <button @click="isDisclaimerExpanded = !isDisclaimerExpanded" class="disclaimer-button">{{ isDisclaimerExpanded ? 'Mostrar menos' : 'Saber m√°s...' }}</button></p>
                <div v-if="isDisclaimerExpanded" class="disclaimer-more">
                    <p>Este servicio utiliza un modelo de inteligencia artificial para generar interpretaciones basadas en los arquetipos y simbolismo del tarot Rider-Waite. No reemplaza la consulta con un profesional del tarot ni constituye asesoramiento legal, financiero, m√©dico o de cualquier otro tipo profesional. Las decisiones que tomes basadas en estas lecturas son de tu exclusiva responsabilidad. La aleatoriedad de las cartas es gestionada digitalmente y la interpretaci√≥n se genera en tiempo real, lo que significa que dos preguntas id√©nticas no necesariamente producir√°n la misma respuesta.</p>
                </div>
            </div>
        </div>

        <footer class="footer">
            <router-link to="/terms">T√©rminos y Condiciones</router-link>
            <span>|</span>
            <router-link to="/privacy">Pol√≠ticas de Privacidad</router-link>
            <span>|</span>
            <router-link to="/cookies">Pol√≠ticas de Cookies</router-link>
        </footer>
    </div>
</template>

<style scoped>
.landing-container { display: flex; flex-direction: column; min-height: 100vh; font-family: 'Georgia', serif; background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460); color: #f4f4f4; text-align: center; padding: 20px; }
.main-content { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; max-width: 800px; margin: 0 auto; }
.title { font-size: 3.5rem; color: #ffd700; text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.6); margin-bottom: 15px; }
.subtitle { font-size: 1.3rem; color: #ddd; font-style: italic; margin-bottom: 40px; line-height: 1.6; }

/* Logged-in View */
.loggedin-view .subtitle { margin-bottom: 30px; }
.initial-chat-box { max-width: 600px; margin: 0 auto 40px; }
.question-input { display: block; width: 100%; padding: 15px; font-family: 'Georgia', serif; font-size: 1.1rem; color: #f4f4f4; background-color: rgba(22, 33, 62, 0.5); border: 2px solid #0f3460; border-radius: 8px; resize: vertical; min-height: 100px; box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3); transition: all 0.3s ease; margin-bottom: 20px; }
.question-input:focus { outline: none; border-color: #ffd700; }

/* CTA */
.main-cta-button { background: linear-gradient(45deg, #8b4513, #a0522d); color: white; text-decoration: none; padding: 18px 40px; font-size: 1.4rem; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4); display: inline-block; border: none; }
.main-cta-button:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5); }
.main-cta-button:disabled { opacity: 0.5; cursor: not-allowed; }

/* Social Login */
.social-login { margin-bottom: 40px; }
.social-login p { margin-bottom: 15px; color: #ccc; }
.social-buttons { display: flex; justify-content: center; gap: 15px; }
.social-btn { border: none; padding: 10px 20px; border-radius: 5px; font-size: 1rem; cursor: pointer; transition: opacity 0.3s; color: white; }
.social-btn.google { background-color: #DB4437; }
.social-btn.facebook { background-color: #4267B2; }
.social-btn.tiktok { background-color: #000000; }
.social-btn:hover { opacity: 0.8; }

/* Offers */
.offer-section { margin-bottom: 40px; }
.offer-section h2 { font-size: 2rem; color: #ffd700; margin-bottom: 20px; }
.offers { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
.offer-card { background: rgba(22, 33, 62, 0.5); padding: 20px; border-radius: 10px; border: 1px solid #0f3460; width: 200px; }
.offer-card.premium { border-color: #ffd700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.3); }
.offer-card h3 { font-size: 1.5rem; margin-bottom: 10px; color: #e0e0e0; }
.offer-card p { font-size: 1rem; line-height: 1.4; }
.offer-card-link { text-decoration: none; color: inherit; }


/* Sign-up Form */
.signup-form-container { max-width: 500px; margin: 0 auto; }
.signup-title { font-size: 2.5rem; color: #ffd700; margin-bottom: 10px; }
.signup-form { display: flex; flex-direction: column; gap: 20px; text-align: left; }
.form-group { display: flex; flex-direction: column; }
.form-group label { margin-bottom: 8px; font-size: 1rem; color: #ccc; }
.form-group input[type="text"], .form-group input[type="date"], .form-group select { width: 100%; padding: 12px; font-size: 1rem; background-color: rgba(22, 33, 62, 0.7); border: 1px solid #0f3460; border-radius: 5px; color: #f4f4f4; }
.form-group.terms { flex-direction: row; align-items: center; gap: 10px; justify-content: center; }
.form-group.terms label { margin-bottom: 0; }
.form-group.terms a { color: #ffd700; text-decoration: none; }
.form-group.terms a:hover { text-decoration: underline; }

/* Disclaimer & Footer */
.disclaimer { font-size: 0.9rem; color: #aaa; max-width: 600px; margin: 40px auto; font-style: italic; line-height: 1.6; }
.disclaimer-button { background: none; border: none; color: #ffd700; cursor: pointer; font-style: italic; text-decoration: underline; padding: 0 5px; font-size: 0.9rem; }
.disclaimer-more { margin-top: 15px; text-align: justify; }

.footer { padding: 15px; border-top: 1px solid #0f3460; }
.footer a, .footer .router-link-active { color: #ccc; text-decoration: none; margin: 0 15px; transition: color 0.3s; }
.footer a:hover, .footer .router-link-active:hover { color: #ffd700; }
.footer span { color: #555; }

/* Simulation controls */
.simulation-controls { position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; z-index: 1000; display: flex; gap: 10px; align-items: center; }
.simulation-controls p { margin: 0; color: white; font-size: 0.9rem; }
.simulation-controls button { background: #555; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; }
</style>